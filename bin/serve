#!/bin/bash

BIN=$(dirname $0)

test -z $1 && ROOT=~/.half.sh/P || ROOT=$1

if [[ -z "$HSH_TRAP" ]] ; then
    echo "setting trap"
    trap "exit" INT TERM
    trap "kill 0" EXIT
fi

$BIN/i $ROOT serve &
$BIN/refresh $ROOT &
websocketd --staticdir=$(dirname $0)/../w2/dist --port 8000 \
    -- sh -c "($BIN/tree $ROOT; tail -n0 -F $ROOT/stream)" &

$BIN/repl $ROOT
