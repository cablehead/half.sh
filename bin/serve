#!/bin/bash

BIN=$(dirname $0)

test -z $1 && ROOT=~/.half.sh || ROOT=$1

if [[ -z "$HSH_TRAP" ]] ; then
    echo "setting trap"
    trap "exit" INT TERM
    trap "kill 0" EXIT
fi

mkdir -p $ROOT/project
touch $ROOT/stream

$BIN/i $ROOT serve &
$BIN/refresh $ROOT &
websocketd --staticdir=$(dirname $0)/../w2/dist --port 8000 \
    -- sh -c "($BIN/tree root $ROOT; tail -n0 -F $ROOT/stream)"
